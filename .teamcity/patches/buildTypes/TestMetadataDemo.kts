package patches.buildTypes

import jetbrains.buildServer.configs.kotlin.v2018_2.*
import jetbrains.buildServer.configs.kotlin.v2018_2.buildSteps.gradle
import jetbrains.buildServer.configs.kotlin.v2018_2.buildSteps.script
import jetbrains.buildServer.configs.kotlin.v2018_2.ui.*

/*
This patch script was generated by TeamCity on settings change in UI.
To apply the patch, change the buildType with id = 'TestMetadataDemo'
accordingly, and delete the patch script.
*/
changeBuildType(RelativeId("TestMetadataDemo")) {
    check(artifactRules == """
        build/reports/tests/test => gradle_test_report.zip
        pictureForAttention.png
    """.trimIndent()) {
        "Unexpected option value: artifactRules = $artifactRules"
    }
    artifactRules = "build/reports/tests/test => gradle_test_report.zip"

    expectSteps {
        gradle {
            tasks = "clean build"
            buildFile = ""
            gradleWrapperPath = ""
        }
    }
    steps {
        insert(1) {
            script {
                executionMode = BuildStep.ExecutionMode.RUN_ON_FAILURE
                scriptContent = """
                    echo "##teamcity[testStarted name='test']"
                    echo "##teamcity[testStdOut name='test' out='##teamcity|[buildProblem description=|'my_problem|'|]' tc:tags='tc:parseServiceMessagesInside']"
                    echo "##teamcity[testFinished name='test']"
                """.trimIndent()
            }
        }
    }
}
